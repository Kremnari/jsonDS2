<template>
  <require from="app.css"></require>
  <require from="resources/elements/typeFields/selector.html" as="field-selector"></require>
  <require from="resources/viewSections/editors/type.html" as="type-editor"></require>
  <require from="resources/viewSections/editors/definition" as="definition-editor"></require>
  <require from="resources/viewElements/contentPropertyLine.html" as="contentPropertyLine"></require>
  <nav>
    <button click.delegate="loadProject()">Load...</button>
    <button click.delegate="saveProject()">Save...</button>
    Editor Save:<input type="checkbox" checked value.bind="suppressEditorSave">
  </nav>
  <div class="content">
    <section id="tablesList">
      <h4>Table/Object List</h4>
      <div note="add new static content table">
        <input type="text" value.bind="newTable"></input>
        <button click.delegate="add('table', {name: newTable})">+&gt;</button>
      </div>
      <div repeat.for="t of jDS2.tables_list & signal:'generalUpdate'" if.bind="jDS2">
        <span click.delegate="showTableContent(t.$name)">${t.$name}</span>
        <input type="checkbox" class="validObject" checked.bind="isTableValid(t.$name) & signal:'updateValids'">
        <span click.delegate="edit('schema', {name: t.$schema})">&#9998;</span>
      </div>
    </section>
    <section id="editorArea" if.bind="editor.as">
      <section if.bind="editor.as == 'list'">
        <div>
          Add new Name:
          <input type="text" value.bind="newContentName"></input>
          <button click.delegate="addNewContentItem(newContentName)">+</button>
        </div>
        <ul>
          <li repeat.for="contentItem of editor.list | objectKeys & signal:'updateValids'">
            <span click.delegate="editContentItem(contentItem)">${editor.list[contentItem].$name}</span>
            <input type="checkbox" checked.bind="isContentValid(editor.table, editor.list[contentItem]) & signal:'updateValids'">
            <button click.delegate="editorDelete(contentItem)">X</button>
          </li>
        </ul>

        <div id="CIEditor" if.bind="editor.CIEdit">
          ${editor.CIEdit.$name}
          <div repeat.for="prop of editor.schema.$fields | objectValues">
            <div
              as-element="contentPropertyLine"
              prop.bind="prop"
              type.bind="jDS2.types_get(prop.$type, prop.$subType)"
              target.bind="editor.CIEdit.$props"
              validator.bind="validator"
            ></div>
          </div>
          <button click.delegate="storeContentItem()">Store</button>
          <button click.delegate="editorDelete()">Delete</button>
          <button click.delegate="editor.CIEdit = null">Cancel</button>
        </div>

      </section>
      <section
        if.bind="editor.as == 'editSchema'"
        as-element="definition-editor"
        def.bind="editor.schema"
        types.bind="jDS2.types_list_base"
        add-field.call="add('schema_field', param)"
        signaler.bind="signaler"
      ></section>
      <section
        if.bind="editor.as == 'editDef'"
        as-element="definition-editor"
        def.bind="editor.def"
        types.bind="jDS2.types_list_base"
        add-field.call="add('def_field', param)"
        signaler.bind="signaler"
      ></section>
      <section
        as-element="type-editor"
        if.bind="editor.as == 'editType'"
        type.bind="editor.schema"
        base-app.bind="baseApp"
        sub-type-of.bind="editor.subTypeOf"
      ></section>
      <button click.delegate="editorCancel()">Cancel</button>
      <button click.delegate="editorDelete()">Delete</button>
      <button click.delegate="editorSave()">Save</button>
    </section>
    <section id="typesList">
      <input class="sectionLinked" type="radio" name="typeOrDefs" id="viewTypes" checked>
      <input class="sectionLinked" type="radio" name="typeOrDefs" id="viewDefs">
      <label for="viewTypes" class="selectHeader">Types List</label>
      <label for="viewDefs"  class="selectHeader">Definitions List</label>
      <div id="viewTypesPane">
        <div note="add new type">
          <input type="text" value.bind="newTypeName"></input>
          <button click.delegate="editTypeOf(newTypeName)">+</button>
        </div>
        <div repeat.for="type of jDS2.types_list" if.bind="jDS2">
          <span click.delegate="editTypeOf(type.$name)">${type.$name}</span>
          <div repeat.for="subT of type.$subTypes | objectValues & signal:'generalUpdate'" if.bind="type.$subTypes">
            <span click.delegate="editTypeOf(type.$name, subT.$name)">&nbsp;-&nbsp;${subT.$name}</span>
          </div>
        </div>
      </div>
      <div id="viewDefsPane">
        <input type="text" value.bind="newDefName">
        <button click.delegate="add('def', {name: newDefName})">+</button>
        <button click.delegate="edit('def', {name: newDefName})">-&gt;</button>
        <div repeat.for="defName of jDS2.defs_list & signal:'generalUpdate'" if.bind="jDS2">
            <span click.delegate="edit('def', {name: defName})">${defName}</span>
        </div>
      </div>
    </section>
    <section id="somethingsomethingdarkside">

    </section>
  </div>
</template>
