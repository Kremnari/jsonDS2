<template>
  <require from="app.css"></require>
  <require from="resources/elements/typeFields/selector.html" as="field-selector"></require>
  <require from="resources/viewSections/typeEditor.html" as="type-editor"></require>
  <require from="resources/viewElements/contentPropertyLine.html" as="contentPropertyLine"></require>
  <nav>
    <button click.delegate="loadProject()">Load...</button>
    <button click.delegate="saveProject()">Save...</button>
    Editor Save:<input type="checkbox" checked value.bind="suppressEditorSave">
  </nav>
  <div class="content">
    <section id="tablesList">
      <h4>Table/Object List</h4>
      <div note="add new static content table">
        <input type="text" value.bind="newTable"></input>
        <button click.delegate="editTableSchema(newTable)">+&gt;</button>
      </div>
      <div repeat.for="t of jDS2.tables_list" if.bind="jDS2">
        <span click.delegate="showTableContent(t.$name)">${t.$name}</span>
        <input type="checkbox" class="validObject" checked.bind="isTableValid(t.$name) & signal:'updateValids'">
        <span click.delegate="editTableSchema(t.$name)">&#9998;</span>
      </div>
    </section>
    <section id="editorArea" if.bind="editor.as">
      <section if.bind="editor.as == 'list'">
        <div>
          Add new Name:
          <input type="text" value.bind="newContentName"></input>
          <button click.delegate="addNewContentItem(newContentName)">+</button>
        </div>
        <ul>
          <li repeat.for="contentItem of editor.list | objectKeys & signal:'updateValids'" click.delegate="editContentItem(contentItem)">
            ${editor.list[contentItem].$name}<input type="checkbox" checked.bind="isContentValid(editor.table, editor.list[contentItem]) & signal:'updateValids'">
          </li>
        </ul>

        <div id="CIEditor" if.bind="editor.CIEdit">
          ${editor.CIEdit.$name}
          Add new Field:
          <select name="types" value.bind="newFieldType">
            <option repeat.for="type of jDS2.types_list" model.bind="type">${type.$name}</option>
          </select>
          <input type="text" value.bind="newFieldName">name</input>
          <button click.delegate="addField(newFieldName, newFieldType)">+</button>
          <div repeat.for="prop of editor.schema.$fields">
            <div
              as-element="contentPropertyLine"
              prop.bind="prop"
              type.bind="jDS2.types_get(prop.$type, prop.$subType)"
              target.bind="editor.CIEdit.$props"
              validator.bind="validator"
            ></div>
          </div>
          <button click.delegate="storeContentItem()">Store</button>
          <button click.delegate="editor.CIEdit = null">Cancel</button>
        </div>

      </section>
      <section if.bind="editor.as == 'editTable'">
        <div class="editField" if.bind="editor.tableField">

        </div>
        <field-selector
          repeat.for="field of editor.schema.$fields"
          field.bind="field"
          type.bind="jDS2.types_get(field.$type, field.$subType)"
          parent.bind="baseApp"
          radio-group="baseSchema"
        ></field-selector>
      </section>
      <section if.bind="editor.as == 'editDef'">
        ${editor.def.$name}
      </section>
      <section
        as-element="type-editor"
        if.bind="editor.as == 'editType'"
        type.bind="editor.schema"
        parent.bind="baseApp"
        sub-type-of.bind="editor.subTypeOf"
      ></section>
      <button click.delegate="editorCancel()">Cancel</button>
      <button click.delegate="editorSave()">Save</button>
    </section>
    <section id="typesList">
      <input class="sectionLinked" type="radio" name="typeOrDefs" id="viewTypes" checked>
      <input class="sectionLinked" type="radio" name="typeOrDefs" id="viewDefs">
      <label for="viewTypes" class="selectHeader">Types List</label>
      <label for="viewDefs"  class="selectHeader">Definitions List</label>
      <div id="viewTypesPane">
        <div note="add new type">
          <input type="text" value.bind="newTypeName"></input>
          <button click.delegate="editTypeOf(newTypeName)">+</button>
        </div>
        <div repeat.for="type of jDS2.types_list" if.bind="jDS2">
          <span click.delegate="editTypeOf(type.$name)">${type.$name}</span>
          <div repeat.for="subT of type.$subTypes | objectValues" if.bind="type.$subTypes">
            <span click.delegate="editTypeOf(type.$name, subT)">&nbsp;-&nbsp;${subT.$name}</span>
          </div>
        </div>
      </div>
      <div id="viewDefsPane">
        <input type="text" value.bind="newDefName">
        <button click.delegate="add('def', newDefName)">+</button>
        <button click.delegate="edit('def', newDefName)">-&gt;</button>
        <div repeat.for="defName of jDS2.defs_list & signal:'generalUpdate'" if.bind="jDS2">
            <span click.delegate="edit('def', defName)">${defName}</span>
        </div>
      </div>
    </section>
    <section id="somethingsomethingdarkside">

    </section>
  </div>
</template>
